#include <gtest/gtest.h>

#include <genetrail2/regulation/RegulatoryImpactFactors.h>

#include <config.h>

using namespace GeneTrail;

/**
 target_sample_group <- c(10.30386641, 9.80778718, 10.2438176, 10.75899577, 8.76191, 10.1916399, 10.274969352, 9.0335984, 12.032738475, 10.55119851, 14.83121325,9.400103835, 11.29339042, 9.4651692, 9.39766313, 14.9243484)
 target_reference_group <- c(9.696793115, 10.831731105, 9.91094377, 9.88740877, 10.3766620315, 8.8604162, 13.5966058, 10.57408575, 11.0335026, 12.151171, 12.02022365, 9.989114332, 9.0125525, 10.1624737, 10.30951001, 11.982188025, 13.35703565)
 regulator_sample_group <- c(11.11585798, 10.7783679, 10.993428135, 10.60248127, 11.03869762, 11.5930671, 10.78949108, 11.5682787, 10.0752486, 10.335266, 10.29724445, 10.69183578, 10.42370977, 10.3883442, 9.8163666, 10.26025286)
 regulator_reference_group <- c(11.27558794, 11.30288544, 10.9666399, 11.05369701, 11.010323906, 11.2192382, 11.0021471, 11.315627, 11.09653034, 9.98846045, 10.70744076, 11.9565329, 11.7380971, 10.912954235, 10.932983303, 10.887045765, 11.36411896)
 rif1 <- function(rrg, trg, rsg, tsg){
       a <- mean(c(trg, tsg))
       d <- mean(tsg) - mean(trg)
       r1 <- cor(tsg, rsg) 
       r2 <- cor(trg, rrg)
       return(a * d * (r1 - r2))
  }
  rif1(regulator_reference_group, target_reference_group, regulator_sample_group, target_sample_group)
 * [1] 0.03296019
 *
 */
TEST(RegulatoryImpactFactors, RIF1) {
   std::vector<double> target_sample_group {10.30386641, 9.80778718, 10.2438176, 10.75899577, 8.76191, 10.1916399, 10.274969352, 9.0335984, 12.032738475, 10.55119851, 14.83121325,	9.400103835, 11.29339042, 9.4651692, 9.39766313, 14.9243484};
   std::vector<double> target_reference_group { 9.696793115, 10.831731105, 9.91094377, 9.88740877, 10.3766620315, 8.8604162, 13.5966058, 10.57408575, 11.0335026, 12.151171, 12.02022365, 9.989114332, 9.0125525, 10.1624737, 10.30951001, 11.982188025, 13.35703565};
   std::vector<double> regulator_sample_group { 11.11585798, 10.7783679, 10.993428135, 10.60248127, 11.03869762, 11.5930671, 10.78949108, 11.5682787, 10.0752486, 10.335266, 10.29724445, 10.69183578, 10.42370977, 10.3883442, 9.8163666, 10.26025286};
   std::vector<double> regulator_reference_group {	11.27558794, 11.30288544, 10.9666399, 11.05369701, 11.010323906, 11.2192382, 11.0021471, 11.315627, 11.09653034, 9.98846045, 10.70744076, 11.9565329, 11.7380971, 10.912954235, 10.932983303, 10.887045765, 11.36411896};
   RIF1 rif1;
   EXPECT_NEAR(rif1.compute(&regulator_reference_group, &target_reference_group, &regulator_sample_group, &target_sample_group), 0.03296019, 0.00001);                                   
}

/**
 target_sample_group <- c(10.30386641, 9.80778718, 10.2438176, 10.75899577, 8.76191, 10.1916399, 10.274969352, 9.0335984, 12.032738475, 10.55119851, 14.83121325,9.400103835, 11.29339042, 9.4651692, 9.39766313, 14.9243484)
 target_reference_group <- c(9.696793115, 10.831731105, 9.91094377, 9.88740877, 10.3766620315, 8.8604162, 13.5966058, 10.57408575, 11.0335026, 12.151171, 12.02022365, 9.989114332, 9.0125525, 10.1624737, 10.30951001, 11.982188025, 13.35703565)
 regulator_sample_group <- c(11.11585798, 10.7783679, 10.993428135, 10.60248127, 11.03869762, 11.5930671, 10.78949108, 11.5682787, 10.0752486, 10.335266, 10.29724445, 10.69183578, 10.42370977, 10.3883442, 9.8163666, 10.26025286)
 regulator_reference_group <- c(11.27558794, 11.30288544, 10.9666399, 11.05369701, 11.010323906, 11.2192382, 11.0021471, 11.315627, 11.09653034, 9.98846045, 10.70744076, 11.9565329, 11.7380971, 10.912954235, 10.932983303, 10.887045765, 11.36411896)
 rif2 <- function(rrg, trg, rsg, tsg){
       e1 <- mean(tsg) 
       e2 <- mean(trg)
       r1 <- cor(tsg, rsg) 
       r2 <- cor(trg, rrg)
       return(((e1 * r1)*(e1 * r1)) - ((e2 * r2)*(e2 * r2)))
  }
  rif1(regulator_reference_group, target_reference_group, regulator_sample_group, target_sample_group)
 * [1] 2.422385
 *
 */
TEST(RegulatoryImpactFactors, RIF2) {
   std::vector<double> target_sample_group {10.30386641, 9.80778718, 10.2438176, 10.75899577, 8.76191, 10.1916399, 10.274969352, 9.0335984, 12.032738475, 10.55119851, 14.83121325,	9.400103835, 11.29339042, 9.4651692, 9.39766313, 14.9243484};
   std::vector<double> target_reference_group { 9.696793115, 10.831731105, 9.91094377, 9.88740877, 10.3766620315, 8.8604162, 13.5966058, 10.57408575, 11.0335026, 12.151171, 12.02022365, 9.989114332, 9.0125525, 10.1624737, 10.30951001, 11.982188025, 13.35703565};
   std::vector<double> regulator_sample_group { 11.11585798, 10.7783679, 10.993428135, 10.60248127, 11.03869762, 11.5930671, 10.78949108, 11.5682787, 10.0752486, 10.335266, 10.29724445, 10.69183578, 10.42370977, 10.3883442, 9.8163666, 10.26025286};
   std::vector<double> regulator_reference_group {	11.27558794, 11.30288544, 10.9666399, 11.05369701, 11.010323906, 11.2192382, 11.0021471, 11.315627, 11.09653034, 9.98846045, 10.70744076, 11.9565329, 11.7380971, 10.912954235, 10.932983303, 10.887045765, 11.36411896};
   RIF2 rif2;
   EXPECT_NEAR(rif2.compute(&regulator_reference_group, &target_reference_group, &regulator_sample_group, &target_sample_group), 2.422385, 0.00001);                                   
}